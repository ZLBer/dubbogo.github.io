{
  "filename": "timeout.md",
  "__html": "<h1>配置调用的超时</h1>\n<h2>1. 准备工作</h2>\n<ul>\n<li>dubbo-go cli 工具和依赖工具已安装</li>\n<li>创建一个新的 demo 应用</li>\n</ul>\n<h2>2. 通过配置项修改 RPC 调用相关参数</h2>\n<h3>2.1 修改调用的超时，并验证</h3>\n<pre><code class=\"language-yaml\"><span class=\"hljs-attr\">dubbo:</span>\n  <span class=\"hljs-attr\">consumer:</span>\n    <span class=\"hljs-attr\">request-timeout:</span> <span class=\"hljs-string\">15s</span> <span class=\"hljs-comment\"># 配置客户端超时</span>\n</code></pre>\n<p>Dubbo-go 应用默认 RPC 超时为 3s，请求超时后，客户端将会返回error 为 context deadline exceeded 的错误。在本任务中，您需要首先修改 demo 应用的 server 函数为较长耗时，然后查看客户端的超时报错；再通过配置客户端超时，使得耗时函数可以正常调用。</p>\n<ol>\n<li>\n<p>go-server/cmd/server.go: 修改 demo 应用 server 的函数为耗时 10s 的函数</p>\n<pre><code class=\"language-go\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(s *GreeterProvider)</span> <span class=\"hljs-title\">SayHello</span><span class=\"hljs-params\">(ctx context.Context, in *api.HelloRequest)</span> <span class=\"hljs-params\">(*api.User, error)</span></span> {\n\tlogger.Infof(<span class=\"hljs-string\">\"Dubbo3 GreeterProvider get user name = %s\\n\"</span>, in.Name)\n\ttime.Sleep(time.Second*<span class=\"hljs-number\">10</span>) <span class=\"hljs-comment\">// sleep 10s</span>\n\t<span class=\"hljs-keyword\">return</span> &amp;api.User{Name: <span class=\"hljs-string\">\"Hello \"</span> + in.Name, Id: <span class=\"hljs-string\">\"12345\"</span>, Age: <span class=\"hljs-number\">21</span>}, <span class=\"hljs-literal\">nil</span>\n}\n</code></pre>\n</li>\n<li>\n<p>客户端发起调用，观察错误日志</p>\n<pre><code>ERROR   cmd/client.go:47        context deadline exceeded\n</code></pre>\n</li>\n<li>\n<p>go-client/conf/dubbogo.yaml: 客户端修改超时</p>\n<pre><code class=\"language-yaml\"><span class=\"hljs-attr\">dubbo:</span>\n  <span class=\"hljs-attr\">consumer:</span>\n    <span class=\"hljs-attr\">request-timeout:</span> <span class=\"hljs-string\">15s</span> <span class=\"hljs-comment\"># 配置客户端超时</span>\n    <span class=\"hljs-attr\">references:</span>\n      <span class=\"hljs-attr\">GreeterClientImpl:</span>\n        <span class=\"hljs-attr\">protocol:</span> <span class=\"hljs-string\">tri</span>\n        <span class=\"hljs-attr\">url:</span> <span class=\"hljs-string\">\"tri://localhost:20000\"</span>\n        <span class=\"hljs-attr\">interface:</span> <span class=\"hljs-string\">\"\"</span> <span class=\"hljs-comment\"># read from pb</span>\n</code></pre>\n</li>\n<li>\n<p>再次通过客户端发起调用，观察日志，正常返回：</p>\n<pre><code class=\"language-bash\">client response result: name:<span class=\"hljs-string\">\"Hello laurence\"</span> id:<span class=\"hljs-string\">\"12345\"</span> age:21\n</code></pre>\n</li>\n</ol>\n",
  "link": "/zh-cn/docs/user/tasks/rpc/timeout.html",
  "meta": {
    "title": "rpc 调用配置",
    "keywords": "rpc 调用配置",
    "description": "rpc 调用配置"
  }
}