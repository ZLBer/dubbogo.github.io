{
  "filename": "pixiu-nacos-triple.md",
  "__html": "<h1>使用 Pixiu 暴露 Dubbo-go 服务</h1>\n<p>Dubbo-go-pixiu 网关支持调用 GO/Java 的 Dubbo 集群。在 Dubbo-go 3.0 的场景下，我们可以通过 Pixiu 网关，在集群外以 HTTP 协议请求 pixiu 网关，在网关层进行协议转换，进一步调用集群内的Dubbo-go 服务。</p>\n<p><img src=\"https://dubbogo.github.io/img/triple-pixiu.png\" alt=\"img\"></p>\n<p>用户调用 Dubbo-go 服务的 path 为http://<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>(</mo><mi>a</mi><mi>p</mi><msub><mi>p</mi><mi>n</mi></msub><mi>a</mi><mi>m</mi><mi>e</mi><mo>)</mo><mi mathvariant=\"normal\">/</mi></mrow><annotation encoding=\"application/x-tex\">(app_name)/</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.75em;\"></span><span class=\"strut bottom\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mopen\">(</span><span class=\"mord mathit\">a</span><span class=\"mord mathit\">p</span><span class=\"mord\"><span class=\"mord mathit\">p</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathit\">n</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mord mathit\">a</span><span class=\"mord mathit\">m</span><span class=\"mord mathit\">e</span><span class=\"mclose\">)</span><span class=\"mord mathrm\">/</span></span></span></span>(service_name)/$(method)</p>\n<p>例如一个proto文件内有如下定义：</p>\n<pre><code class=\"language-protobuf\"><span class=\"hljs-keyword\">package</span> org.apache.dubbo.quickstart.samples;\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">service</span> <span class=\"hljs-title\">UserProvider</span> </span>{\n  <span class=\"hljs-function\"><span class=\"hljs-keyword\">rpc</span> SayHello (HelloRequest) <span class=\"hljs-keyword\">returns</span> (User) {}\n}\n\nmessage HelloRequest {\n  string name = 1</span>;\n}\n</code></pre>\n<p>并在dubbo-go 服务启动时在dubbogo.yml 内配置应用名为my-dubbogo-app:</p>\n<pre><code class=\"language-yaml\"><span class=\"hljs-attr\">dubbo:</span>\n\t<span class=\"hljs-attr\">application:</span>\n  \t<span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">my-dubbogo-app</span>\n</code></pre>\n<p>pixiu 网关即可解析 path 为 <a href=\"http://my-dubbogo-app/org.apache.dubbo.quickstart.samples.UserProvider/SayHello\">http://my-dubbogo-app/org.apache.dubbo.quickstart.samples.UserProvider/SayHello</a> 的路由，并转发至对应服务。来自外部HTTP 请求的 body 为 json 序列化的请求参数，例如 {&quot;name&quot;:&quot;test&quot;}。</p>\n<p>我们目前推荐使用 Nacos 作为注册中心。</p>\n<p>用户可以在自己的集群里部署我们的demo，集群最好拥有暴露 lb 类型 service 的能力，从而可以在公网访问至集群内的服务，您也可以直接集群内进行请求。针对您的集群，执行：</p>\n<pre><code class=\"language-bash\">$ kubectl apply -f https://raw.githubusercontent.com/dubbogo/triple-pixiu-demo/master/deploy/pixiu-triple-demo.yml\n</code></pre>\n<p>会在 dubbogo-triple-nacos 命名空间下创建如下资源，包含三个 triple-server，一个pixiu网关，一个 nacos server。并通过 Servcie 将服务暴露至公网。</p>\n<pre><code class=\"language-plain\">namespace/dubbogo-triple-nacos created\nservice/dubbo-go-nacos created\ndeployment.apps/dubbogo-nacos-deployment created\ndeployment.apps/pixiu created\ndeployment.apps/server created\nservice/pixiu created\n</code></pre>\n<p>获取 pixiu 公网 ip 并进行调用</p>\n<pre><code class=\"language-plain\">$ kubectl get svc -n dubbogo-triple-nacos\nNAME             TYPE           CLUSTER-IP        EXTERNAL-IP     PORT(S)          AGE\ndubbo-go-nacos   ClusterIP      192.168.123.204   &lt;none&gt;          8848/TCP         32s\npixiu            LoadBalancer   192.168.156.175   30.XXX.XXX.XX   8881:30173/TCP   32s\n</code></pre>\n<p>通过curl 调用 demo 服务，并获得响应结果。</p>\n<pre><code class=\"language-bash\">$ curl -X POST -d <span class=\"hljs-string\">'{\"name\":\"laurence\"}'</span> http://30.XXX.XXX.XX:8881/dubbogoDemoServer/org.apache.dubbo.laurence.samples.UserProvider/SayHello\n{<span class=\"hljs-string\">\"name\"</span>:<span class=\"hljs-string\">\"Hello laurence\"</span>,<span class=\"hljs-string\">\"id\"</span>:<span class=\"hljs-string\">\"12345\"</span>,<span class=\"hljs-string\">\"age\"</span>:21}\n</code></pre>\n<p>下一章: <a href=\"./grpc_cli.html\">【使用 grpc_cli 调试 Dubbo-go 服务】</a></p>\n",
  "link": "/zh-cn/docs/user/samples/pixiu-nacos-triple.html",
  "meta": {
    "title": "dubbogo 3.0 自定义filter",
    "keywords": "dubbogo 3.0 自定义filter",
    "description": "dubbogo 3.0 自定义filter"
  }
}