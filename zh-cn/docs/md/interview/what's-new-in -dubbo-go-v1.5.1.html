<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="keywords" content="dubbogo go" />
	<meta name="description" content="dubbo-go的v1.5.0版本介绍" />
	<!-- 网页标签标题 -->
	<title>Dubbo-go v1.5.1 发布，Apache Dubbo 的 Go 实现</title>
	<link rel="shortcut icon" href="/img/dubbo.ico"/>
	<link rel="stylesheet" href="/build/documentation.css" />
</head>
<body>
	<div id="root"><div class="documentation-page" data-reactroot=""><header class="header-container header-container-normal"><div class="header-body"><a href="/zh-cn/index.html"><img class="logo" src="/img/dubbo_colorful.png"/></a><div class="search search-normal"><span class="icon-search"></span></div><span class="language-switch language-switch-normal">En</span><div class="header-menu"><img class="header-menu-toggle" src="/img/menu_gray.png"/><ul><li class="menu-item menu-item-normal"><a href="/zh-cn/index.html">首页</a></li><li class="menu-item menu-item-normal menu-item-normal-active"><a href="/zh-cn/docs/user/quickstart/3.0/quickstart.html">文档</a></li><li class="menu-item menu-item-normal"><a href="/zh-cn/blog/index.html">博客</a></li><li class="menu-item menu-item-normal"><a href="/zh-cn/community/index.html">社区</a></li><li class="menu-item menu-item-normal"><a href="/zh-cn/blog/download.html">下载</a></li><li class="menu-item menu-item-normal"><a href="https://dubbo.io">Java</a></li></ul></div></div></header><div class="bar"><div class="bar-body"><img src="/img/docs.png" class="front-img"/><span>文档</span><img src="/img/docs.png" class="back-img"/></div></div><section class="content-section"><div class="sidemenu"><div class="sidemenu-toggle"><img src="https://img.alicdn.com/tfs/TB1E6apXHGYBuNjy0FoXXciBFXa-200-200.png"/></div><ul><li class="menu-item menu-item-level-1"><span>Dubbo-go 3.0</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>简介<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/preface/3.0_feature.html" target="_self">新特性介绍</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/preface/architecture.html" target="_self">架构</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>快速开始<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/quickstart/3.0/quickstart_triple.html" target="_self">Triple 协议快速开始</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/quickstart/3.0/quickstart_dubbo.html" target="_self">Dubbo 协议快速开始</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>基本概念<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/concept/app_and_interface.html" target="_self">服务层级</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/concept/protocol.html" target="_self">网络协议</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/concept/registry.html" target="_self">注册中心</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/concept/configuration.html" target="_self">框架配置</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>高级使用<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/samples/samples_repo.html" target="_self">Samples 仓库介绍</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/samples/go_java_interactive.html" target="_self">Go-Java 互通</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/samples/config-center-dynamic.html" target="_self">配置中心和配置监听</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/samples/custom-filter.html" target="_self">Filter</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/samples/registry.html" target="_self">注册中心配置</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/samples/exception_response.html" target="_self">Triple 异常回传</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/samples/custom-logger.html" target="_self">日志</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/samples/metrics.html" target="_self">Metrics 数据上报</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/samples/generic.html" target="_self">泛化调用</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/samples/service-discovery.html" target="_self">应用级服务发现</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/samples/mesh_router.html" target="_self">路由规则</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>开发者指南<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/developer/design.html" target="_self">框架设计</a></li></ul></li></ul></li><li class="menu-item menu-item-level-1"><span>Dubbo-go 1.5</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/user/quickstart/1.5/quick-start.html" target="_self">快速开始</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>配置<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/configuration/provider.html" target="_self">服务提供者</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/configuration/client.html" target="_self">消费者</a></li></ul></li></ul></li><li class="menu-item menu-item-level-1"><span>Dubbo-go 生态项目</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/user/ecology/ecology.html" target="_self">Dubbo-go 生态项目</a></li></ul></li></ul></div><div class="doc-content markdown-body"><h1><a href="https://www.oschina.net/news/118469/dubbo-go-1-5-1-released">Dubbo-go v1.5.1 发布，Apache Dubbo 的 Go 实现</a></h1>
<p>Dubbo-go 团队近期发布了 Dubbo-go v1.5.1，Dubbo-go 是 Apache Dubbo 项目的 Go 实现。</p>
<p>根据团队的介绍，虽然 v1.5.1 是 v1.5 的一个子版本，但相比于 v1.5.0， 社区还是投入了很大人力添加了如下重大改进。</p>
<h2>1 应用维度注册模型</h2>
<p>在新模型 release 后，团队发现 Provider 每个 URL 发布元数据都会注册 ServiceInstance，影响性能需要优化。</p>
<p>优化方案是： 去除 ServiceDiscoveryRegistry 中注册 ServiceInstance 的代码，在 config_loader 中的 loadProviderConfig 方法的最后注册 ServiceInstance 具体步骤：</p>
<p>1、获取所有注册的 Registry，过滤出 ServiceDiscoveryRegistry，拿取所有 ServiceDiscovery。
2、创建 ServiceInstance。
3、每个 ServiceDiscovery 注册 ServiceInstance。</p>
<p>保证 Provider 在注册成功之后，才暴露元数据信息。</p>
<h2>2 支持基于 Seata 的事务</h2>
<p>基于 Seata 扩展实现。通过增加过滤器，在服务端接收 xid 并结合 seata-golang 达到支持分布式事务的目的。 从而使 Dubbo-go 在分布式场景下，让用户有更多的选择，能适应更多的个性化场景。</p>
<p>开发团队在 dubbo-samples 中给出了 事务测试用例 。</p>
<h2>3 多注册中心集群负载均衡</h2>
<p>对于多注册中心订阅的场景，选址时的多了一层注册中心集群间的负载均衡：</p>
<p>在 Cluster Invoker 这一级，支持的选址策略有：</p>
<ul>
<li>指定优先级</li>
<li>同 zone 优先</li>
<li>权重轮询</li>
</ul>
<h2>3 传输链路安全性</h2>
<p>该版本在传输链路的安全性上做了尝试，对于内置的 Dubbo getty Server 提供了基于 TLS 的安全链路传输机制。</p>
<p>为尽可能保证应用启动的灵活性，TLS Cert 的指定通过配置文件方式，具体请参见 Dubbo-go 配置读取规则与 TLS 示例：</p>
<h2>4 路由功能增强</h2>
<p>本次路由功能重点支持了 动态标签路由 和 应用/服务级条件路由。</p>
<h3>4.1 动态标签路由</h3>
<p>标签路由通过将某一个或多个服务的提供者划分到同一个分组，约束流量只在指定分组中流转，从而实现流量隔离的目的，可以作为蓝绿发布、灰度发布等场景的能力基础。</p>
<p>标签主要是指对 Provider 端应用实例的分组，目前有两种方式可以完成实例分组，分别是动态规则打标和静态规则打标，其中动态规则相较于静态规则优先级更高，而当两种规则同时存在且出现冲突时，将以动态规则为准。</p>
<h3>4.1.1 动态规则打标</h3>
<p>可随时在服务治理控制台下发标签归组规则</p>
<pre><code class="language-yml"><span class="hljs-comment"># governance-tagrouter-provider应用增加了两个标签分组tag1和tag2</span>
<span class="hljs-comment"># tag1包含一个实例 127.0.0.1:20880</span>
<span class="hljs-comment"># tag2包含一个实例 127.0.0.1:20881</span>
<span class="hljs-meta">---</span>
  <span class="hljs-attr">force:</span> <span class="hljs-literal">false</span>
  <span class="hljs-attr">runtime:</span> <span class="hljs-literal">true</span>
  <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>
  <span class="hljs-attr">key:</span> <span class="hljs-string">governance-tagrouter-provider</span>
  <span class="hljs-attr">tags:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">tag1</span>
      <span class="hljs-attr">addresses:</span> <span class="hljs-string">["127.0.0.1:20880"]</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">tag2</span>
      <span class="hljs-attr">addresses:</span> <span class="hljs-string">["127.0.0.1:20881"]</span>
 <span class="hljs-string">...</span>
</code></pre>
<h3>4.1.2 静态规则打标</h3>
<p>可以在 server 配置文件的 tag 字段里设置</p>
<pre><code class="language-yml"><span class="hljs-attr">services:</span>
  <span class="hljs-attr">"UserProvider":</span>
    <span class="hljs-attr">registry:</span> <span class="hljs-string">"hangzhouzk"</span>
    <span class="hljs-attr">protocol:</span> <span class="hljs-string">"dubbo"</span>
    <span class="hljs-attr">interface:</span> <span class="hljs-string">"com.ikurento.user.UserProvider"</span>
    <span class="hljs-attr">loadbalance:</span> <span class="hljs-string">"random"</span>
    <span class="hljs-attr">warmup:</span> <span class="hljs-string">"100"</span>
    <span class="hljs-attr">tag:</span> <span class="hljs-string">"beijing"</span>
    <span class="hljs-attr">cluster:</span> <span class="hljs-string">"failover"</span>
    <span class="hljs-attr">methods:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">"GetUser"</span>
        <span class="hljs-attr">retries:</span> <span class="hljs-number">1</span>
        <span class="hljs-attr">loadbalance:</span> <span class="hljs-string">"random"</span>
</code></pre>
<p>consumer 添加 tag 至 attachment 即可</p>
<pre><code class="language-go">ctx := context.Background()
attachment := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">string</span>)
attachment[<span class="hljs-string">"dubbo.tag"</span>] = <span class="hljs-string">"beijing"</span>
ctx = context.WithValue(ctx, constant.AttachmentKey, attachment)
err := userProvider.GetUser(ctx, []<span class="hljs-keyword">interface</span>{}{<span class="hljs-string">"A001"</span>}, user)
</code></pre>
<p>请求标签的作用域为每一次 invocation，使用 attachment 来传递请求标签，注意保存在 attachment 中的值将会在一次完整的远程调用中持续传递，得益于这样的特性，只需要在起始调用时，通过一行代码的设置，达到标签的持续传递。</p>
<h3>4.1.3 规则详解</h3>
<p>格式
Key 明确规则体作用到哪个应用。必填。
enabled=true 当前路由规则是否生效，可不填，缺省生效。
force=false 当路由结果为空时，是否强制执行，如果不强制执行，路由结果为空的路由规则将自动失效，可不填，缺省为 false。
runtime=false 是否在每次调用时执行路由规则，否则只在提供者地址列表变更时预先执行并缓存结果，调用时直接从缓存中获取路由结果。如果用了参数路由，必须设为 true，需要注意设置会影响调用的性能，可不填，缺省为 false。
priority=1 路由规则的优先级，用于排序，优先级越大越靠前执行，可不填，缺省为 0。
tags 定义具体的标签分组内容，可定义任意 n（n&gt;=1）个标签并为每个标签指定实例列表。必填
name， 标签名称
addresses， 当前标签包含的实例列表
降级约定
request.tag=tag1 时优先选择 标记了 tag=tag1 的 provider。若集群中不存在与请求标记对应的服务，默认将降级请求 tag 为空的 provider；如果要改变这种默认行为，即找不到匹配 tag1 的 provider 返回异常，需设置 request.tag.force=true。
request.tag 未设置时，只会匹配 tag 为空的 provider。即使集群中存在可用的服务，若 tag 不匹配也就无法调用，这与约定 1 不同，携带标签的请求可以降级访问到无标签的服务，但不携带标签/携带其他种类标签的请求永远无法访问到其他标签的服务。</p>
<h2>4.2 应用/服务级条件路由</h2>
<p>可以在路由规则配置中配置多个条件路由及其粒度</p>
<p>Sample:</p>
<pre><code class="language-yml"><span class="hljs-comment"># dubbo router yaml configure file</span>
<span class="hljs-attr">routerRules:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">scope:</span> <span class="hljs-string">application</span>
    <span class="hljs-attr">key:</span> <span class="hljs-string">BDTService</span>
    <span class="hljs-attr">priority:</span> <span class="hljs-number">1</span>
    <span class="hljs-attr">enable:</span> <span class="hljs-literal">false</span>
    <span class="hljs-attr">force:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">conditions:</span> <span class="hljs-string">["host</span> <span class="hljs-string">=</span> <span class="hljs-number">192.168</span><span class="hljs-number">.199</span><span class="hljs-number">.208</span> <span class="hljs-string">=&gt;</span> <span class="hljs-string">host</span> <span class="hljs-string">=</span> <span class="hljs-number">192.168</span><span class="hljs-number">.199</span><span class="hljs-number">.208</span> <span class="hljs-string">"]
  - scope: service
    key: com.ikurento.user.UserProvider
    priority: 1
    force: true
    conditions: ["</span><span class="hljs-string">host</span> <span class="hljs-string">=</span> <span class="hljs-number">192.168</span><span class="hljs-number">.199</span><span class="hljs-number">.208</span> <span class="hljs-string">=&gt;</span> <span class="hljs-string">host</span> <span class="hljs-string">=</span> <span class="hljs-number">192.168</span><span class="hljs-number">.199</span><span class="hljs-number">.208</span> <span class="hljs-string">"]
</span></code></pre>
<h3>4.2.1 规则详解</h3>
<h4>各字段含义</h4>
<ul>
<li>scope 表示路由规则的作用粒度，scope 的取值会决定 key 的取值。必填。
<ul>
<li>service 服务粒度</li>
<li>application 应用粒度</li>
</ul>
</li>
<li>Key 明确规则体作用在哪个服务或应用。必填。
<ul>
<li>scope=service 时，key 取值为[{group}/]{service}[:{version}]的组合</li>
<li>scope=application 时，key 取值为 application 名称</li>
</ul>
</li>
<li>enabled=true 当前路由规则是否生效，可不填，缺省生效。</li>
<li>force=false 当路由结果为空时，是否强制执行，如果不强制执行，路由结果为空的路由规则将自动失效，可不填，缺省为 false。</li>
<li>runtime=false 是否在每次调用时执行路由规则，否则只在提供者地址列表变更时预先执行并缓存结果，调用时直接从缓存中获取路由结果。如果用了参数路由，必须设为 true，需要注意设置会影响调用的性能，可不填，缺省为 false。</li>
<li>priority=1 路由规则的优先级，用于排序，优先级越大越靠前执行，可不填，缺省为 0。</li>
<li>conditions 定义具体的路由规则内容。必填。</li>
</ul>
<h2>5 回顾与展望</h2>
<p>Dubbo-go 处于一个比较稳定成熟的状态。目前新版本正处于往云原生方向的尝试，应用服务维度注册是首先推出的功能，这是一个和之前模型完全不一样的新注册模型。该版本是朝云原生迈进新一步的关键版本。除此之外，包含在该版本也有一些之前提到的优化。</p>
<p>下一个版本 v1.5.2，本次的关注重点以通信模型改进为主，除此之外，与 2.7.x 的兼容性、易用性及质量保证也是本次关注的信息。</p>
<p>在服务发现，会支持更加多的方式，如：文件、Consul。 从而使 Dubbo-go 在服务发现场景下，让用户有更多的选择，能适应更多的个性化场景。</p>
<p>另外 易用性及质量保证，主要关注的是 samples 与自动化构建部分。可降低用户上手 Dubbo-go 的难度，提高代码质量。</p>
<p>目前下一个版本正在紧锣密鼓的开发中，具体规划及任务清单，都已经在 Github 上体现。</p>
<p>更多信息：<a href="https://github.com/apache/dubbo-go/releases/tag/v1.5.1">https://github.com/apache/dubbo-go/releases/tag/v1.5.1</a></p>
</div></section><footer class="footer-container"><div class="footer-body"><img src="/img/dubbo_gray.png"/><img class="apache" src="/img/apache_logo.png"/><div class="cols-container"><div class="col col-12"><h3></h3><p></p></div><div class="col col-4"><dl><dt>ASF</dt><dd><a href="http://www.apache.org" target="_self">基金会</a></dd><dd><a href="http://www.apache.org/licenses/" target="_self">证书</a></dd><dd><a href="http://www.apache.org/events/current-event" target="_self">事件</a></dd><dd><a href="http://www.apache.org/foundation/sponsorship.html" target="_self">赞助</a></dd><dd><a href="http://www.apache.org/foundation/thanks.html" target="_self">致谢</a></dd></dl></div><div class="col col-4"><dl><dt>文档</dt><dd><a href="/zh-cn/docs/user/quickstart/3.0/quickstart.html" target="_self">快速开始</a></dd><dd><a href="/zh-cn/docs/dev/build.html" target="_self">开发者指南</a></dd><dd><a href="/zh-cn/docs/admin/ops/dubbo-ops.html" target="_self">运维管理</a></dd><dd><a href="https://github.com/dubbogo/dubbogo.github.io/issues/new" target="_self">报告文档问题</a></dd><dd><a href="https://github.com/dubbogo/dubbogo.github.io" target="_self">编辑此文档</a></dd></dl></div><div class="col col-4"><dl><dt>资源</dt><dd><a href="/zh-cn/blog/index.html" target="_self">博客</a></dd><dd><a href="/zh-cn/community/index.html" target="_self">社区</a></dd><dd><a href="https://www.apache.org/security" target="_self">安全</a></dd></dl></div></div><div class="copyright"><span>Copyright © 2018-2020 The Apache Software Foundation. Apache and the Apache feather logo are trademarks of The Apache Software Foundation.</span></div></div></footer></div></div>
	<script src="https://f.alicdn.com/react/15.4.1/react-with-addons.min.js"></script>
	<script src="https://f.alicdn.com/react/15.4.1/react-dom.min.js"></script>
	<script>
		window.rootPath = '';
  </script>
  <script src="/build/documentation.js"></script>
  <!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-112489517-1"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());

		gtag('config', 'UA-112489517-1');
	</script>
</body>
</html>