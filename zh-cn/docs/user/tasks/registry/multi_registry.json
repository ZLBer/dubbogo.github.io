{
  "filename": "multi_registry.md",
  "__html": "<h1>多注册中心</h1>\n<p>一个 Dubbo-go 应用可以配置的多个接口维度的注册中心。</p>\n<h2>1. 准备工作</h2>\n<ul>\n<li>dubbo-go cli 工具和依赖工具已安装</li>\n<li>创建一个新的 demo 应用</li>\n<li>本地启动Nacos、Zookeeper</li>\n</ul>\n<h2>2. 使用多注册中心</h2>\n<p>修改服务端配置 go-server/conf/dubbogo.yaml， 同时将服务注册在两个注册中心上。</p>\n<pre><code class=\"language-yaml\"><span class=\"hljs-attr\">dubbo:</span>\n  <span class=\"hljs-attr\">registries:</span>\n    <span class=\"hljs-attr\">zookeeper:</span> <span class=\"hljs-comment\"># 指定 zookeeper 注册中心</span>\n      <span class=\"hljs-attr\">protocol:</span> <span class=\"hljs-string\">zookeeper</span>\n      <span class=\"hljs-attr\">address:</span> <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span><span class=\"hljs-string\">:2181</span>\n    <span class=\"hljs-attr\">nacos:</span> <span class=\"hljs-comment\"># 指定 nacos 注册中心</span>\n      <span class=\"hljs-attr\">protocol:</span> <span class=\"hljs-string\">nacos</span>\n      <span class=\"hljs-attr\">address:</span> <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span><span class=\"hljs-string\">:8848</span>\n  <span class=\"hljs-attr\">protocols:</span>\n    <span class=\"hljs-attr\">triple:</span>\n      <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">tri</span>\n      <span class=\"hljs-attr\">port:</span> <span class=\"hljs-number\">20000</span>\n  <span class=\"hljs-attr\">provider:</span>\n    <span class=\"hljs-attr\">services:</span>\n      <span class=\"hljs-attr\">GreeterProvider:</span>\n        <span class=\"hljs-attr\">registry-ids:</span> <span class=\"hljs-comment\"># 同时注册</span>\n          <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">zookeeper</span>\n          <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">nacos</span>\n        <span class=\"hljs-attr\">interface:</span> <span class=\"hljs-string\">\"\"</span> \n</code></pre>\n<p>修改客户端配置 go-client/conf/dubbogo.yaml</p>\n<pre><code class=\"language-yaml\"><span class=\"hljs-attr\">dubbo:</span>\n  <span class=\"hljs-attr\">registries:</span>\n    <span class=\"hljs-attr\">nacos:</span> <span class=\"hljs-comment\"># 指定 nacos 注册中心</span>\n      <span class=\"hljs-attr\">protocol:</span> <span class=\"hljs-string\">nacos</span>\n      <span class=\"hljs-attr\">address:</span> <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span><span class=\"hljs-string\">:8848</span>\n    <span class=\"hljs-attr\">zookeeper:</span> <span class=\"hljs-comment\"># 指定 zookeeper 注册中心</span>\n      <span class=\"hljs-attr\">protocol:</span> <span class=\"hljs-string\">zookeeper</span>\n      <span class=\"hljs-attr\">address:</span> <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span><span class=\"hljs-string\">:2181</span>\n  <span class=\"hljs-attr\">consumer:</span>\n    <span class=\"hljs-attr\">references:</span>\n      <span class=\"hljs-attr\">GreeterClientImpl:</span>\n        <span class=\"hljs-attr\">registry-ids:</span> <span class=\"hljs-comment\"># 从 nacos 注册中心服务发现</span>\n          <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">nacos</span>\n        <span class=\"hljs-attr\">protocol:</span> <span class=\"hljs-string\">tri</span>\n        <span class=\"hljs-attr\">interface:</span> <span class=\"hljs-string\">\"\"</span> \n      <span class=\"hljs-attr\">GreeterClientImpl2:</span>\n        <span class=\"hljs-attr\">registry-ids:</span>  <span class=\"hljs-comment\"># 从 zookeeeper 注册中心服务发现</span>\n          <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">zookeeper</span>\n        <span class=\"hljs-attr\">protocol:</span> <span class=\"hljs-string\">tri</span>\n        <span class=\"hljs-attr\">interface:</span> <span class=\"hljs-string\">\"\"</span>\n</code></pre>\n<p>修改客户端代码，再定义一个客户端存根类，名为GreeterClientImpl2：</p>\n<pre><code class=\"language-go\"><span class=\"hljs-keyword\">var</span> grpcGreeterImpl2 = <span class=\"hljs-built_in\">new</span>(GreeterClientImpl2)\n\n<span class=\"hljs-keyword\">type</span> GreeterClientImpl2 <span class=\"hljs-keyword\">struct</span>{\n\tapi.GreeterClientImpl\n}\n</code></pre>\n<p>客户端编写调用代码：</p>\n<pre><code class=\"language-go\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-title\">main</span><span class=\"hljs-params\">()</span></span> {\n\tconfig.SetConsumerService(grpcGreeterImpl)\n\tconfig.SetConsumerService(grpcGreeterImpl2)\n\t<span class=\"hljs-keyword\">if</span> err := config.Load(); err != <span class=\"hljs-literal\">nil</span> {\n\t\t<span class=\"hljs-built_in\">panic</span>(err)\n\t}\n\n\tlogger.Info(<span class=\"hljs-string\">\"start to test dubbo\"</span>)\n\treq := &amp;api.HelloRequest{\n\t\tName: <span class=\"hljs-string\">\"laurence\"</span>,\n\t}\n\treply, err := grpcGreeterImpl.SayHello(context.Background(), req)\n\t<span class=\"hljs-keyword\">if</span> err != <span class=\"hljs-literal\">nil</span> {\n\t\tlogger.Error(err)\n\t}\n\tlogger.Infof(<span class=\"hljs-string\">\"nacos server response result: %v\\n\"</span>, reply)\n\n\treply, err = grpcGreeterImpl2.SayHello(context.Background(), req)\n\t<span class=\"hljs-keyword\">if</span> err != <span class=\"hljs-literal\">nil</span> {\n\t\tlogger.Error(err)\n\t}\n\tlogger.Infof(<span class=\"hljs-string\">\"zk server response result: %v\\n\"</span>, reply)\n}\n\n</code></pre>\n<h2>3. 多注册中心服务发现验证</h2>\n<p>分别启动 go-server/cmd 和 go-client/cmd 查看两条调用成功的日志：</p>\n<pre><code>INFO    cmd/client.go:55        nacos server response result: name:&quot;Hello laurence&quot; id:&quot;12345&quot; age:21\n\nINFO    cmd/client.go:61        zk server response result: name:&quot;Hello laurence&quot; id:&quot;12345&quot; age:21\n\n</code></pre>\n",
  "link": "/zh-cn/docs/user/tasks/registry/multi_registry.html",
  "meta": {
    "title": "多注册中心",
    "keywords": "多注册中心",
    "description": "多注册中心"
  }
}